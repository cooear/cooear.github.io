
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Redis Command Support in Codis - 酷耳</title>
  <meta name="author" content="cooear">
  <meta name="description" content="codis中支持的Redis命令。">
  <meta name="keywords" content="Redis, codis, command, 命令">
  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="baidu-site-verification" content="1Lwtt89368" />

  
  <link rel="canonical" href="http://cooear.com/blog/2016/07/redis-command-support-in-codis/">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="酷耳" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/libs/jquery/jquery-2.1.3.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.useso.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.useso.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<script type="text/javascript">
	function addBlankTargetForLinks () {
	  $('a[href^="http"]').each(function(){
	      $(this).attr('target', '_blank');
	  });
	}

	$(document).bind('DOMNodeInserted', function(event) {
	  addBlankTargetForLinks();
	});	
	<!--URL兼容 begin-->
	var url = window.location.pathname;
    if(url.indexOf("/archives/185.htm") >= 0 ){
        top.location='/blog/2014/05/goagent-switchysharp-tu-wen-jiao-cheng/'; 
    }
    if(url.indexOf("/archives/239.htm") >= 0 ){
        top.location='/blog/2014/08/lantern-deng-long-an-zhuang-he-shi-yong-jiao-cheng/'; 
    }
    <!--end-->
</script>
  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">酷耳</a></h1>
  
    <h2>临渊羡鱼 不如退而结网.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="cooear.com">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Redis Command Support in Codis</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-07-04T16:26:18+08:00'><span class='date'>2016-07-04</span> <span class='time'>4:26 pm</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><h3>Keys Command</h3>

<pre><code>+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      Command      | Supported? | Format                                                                                                              |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|        DEL        |    Yes     | DEL key [key …]                                                                                                     |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|       DUMP        |    Yes     | DUMP key                                                                                                            |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      EXISTS       |    Yes     | EXISTS key                                                                                                          |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      EXPIRE       |    Yes     | EXPIRE key seconds                                                                                                  |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|     EXPIREAT      |    Yes     | EXPIREAT key timestamp                                                                                              |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|       KEYS        |    No      | KEYS pattern                                                                                                        |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      MIGRATE      |    No      | MIGRATE host port key destination-db timeout                                                                        |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|       MOVE        |    No      | MOVE key db                                                                                                         |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      OBJECT       |    No      | OBJECT subcommand [arguments [arguments …]]                                                                         |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      PERSIST      |    Yes     | PERSIST key                                                                                                         |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      PEXPIRE      |    Yes     | PEXPIRE key milliseconds                                                                                            |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|     PEXPIREAT     |    Yes     | PEXPIREAT key milliseconds-timestamp                                                                                |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      PTTL         |    Yes     | PTTL key                                                                                                            |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|     RANDOMKEY     |    No      | RANDOMKEY                                                                                                           |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      RENAME       |    No      | RENAME key newkey                                                                                                   |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|     RENAMENX      |    No      | RENAMENX key newkey                                                                                                 |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      RESTORE      |    Yes     | RESTORE key ttl serialized-value                                                                                    |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      SORT         |    Yes     | SORT key [BY pattern] [LIMIT offset count] [GET pattern [GET pattern ...]] [ASC|DESC] [ALPHA] [STORE destination]   |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|       TTL         |    Yes     | TTL key                                                                                                             |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      TYPE         |    Yes     | TYPE key                                                                                                            |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      SCAN         |    No      | SCAN cursor [MATCH pattern] [COUNT count]                                                                           |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
</code></pre>

<!--more-->


<p></p>

<h3>Strings Command</h3>

<pre><code>+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      Command      | Supported? | Format                                                                                                              |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|       APPEND      |    Yes     | APPEND key value                                                                                                    |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      BITCOUNT     |    Yes     | BITCOUNT key [start] [end]                                                                                          |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      BITPOS       |    Yes     | BITPOS key bit [start] [end]                                                                                          |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|       BITOP       |    No      | BITOP operation destkey key [key ...]                                                                               |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|       DECR        |    Yes     | DECR key                                                                                                            |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      DECRBY       |    Yes     | DECRBY key decrement                                                                                                |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|       GET         |    Yes     | GET key                                                                                                             |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      GETBIT       |    Yes     | GETBIT key offset                                                                                                   |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|     GETRANGE      |    Yes     | GETRANGE key start end                                                                                              |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      GETSET       |    Yes     | GETSET key value                                                                                                    |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      INCR         |    Yes     | INCR key                                                                                                            |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      INCRBY       |    Yes     | INCRBY key increment                                                                                                |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|     INCRBYFLOAT   |    Yes     | INCRBYFLOAT key increment                                                                                           |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      MGET         |    Yes     | MGET key [key ...]                                                                                                  |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      MSET         |    Yes*    | MSET key value [key value ...]                                                                                      |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      MSETNX       |    No      | MSETNX key value [key value ...]                                                                                    |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      PSETEX       |    Yes     | PSETEX key milliseconds value                                                                                       |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      SET          |    Yes     | SET key value [EX seconds] [PX milliseconds] [NX|XX]                                                                |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      SETBIT       |    Yes     | SETBIT key offset value                                                                                             |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      SETEX        |    Yes     | SETEX key seconds value                                                                                             |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      SETNX        |    Yes     | SETNX key value                                                                                                     |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      SETRANGE     |    Yes     | SETRANGE key offset value                                                                                           |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      STRLEN       |    Yes     | STRLEN key                                                                                                          |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
</code></pre>

<ul>
<li>MSET support is not Atomic</li>
</ul>


<h3>Hashes</h3>

<pre><code>+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      Command      | Supported? | Format                                                                                                              |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|       HDEL        |    Yes     | HDEL key field [field ...]                                                                                          |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      HEXISTS      |    Yes     | HEXISTS key field                                                                                                   |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|       HGET        |    Yes     | HGET key field                                                                                                      |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      HGETALL      |    Yes     | HGETALL key                                                                                                         |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      HINCRBY      |    Yes     | HINCRBY key field increment                                                                                         |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|    HINCRBYFLOAT   |    Yes     | HINCRBYFLOAT key field increment                                                                                    |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      HKEYS        |    Yes     | HKEYS key                                                                                                           |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      HLEN         |    Yes     | HLEN key                                                                                                            |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      HMGET        |    Yes     | HMGET key field [field ...]                                                                                         |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      HMSET        |    Yes     | HMSET key field value [field value ...]                                                                             |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      HSET         |    Yes     | HSET key field value                                                                                                |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      HSETNX       |    Yes     | HSETNX key field value                                                                                              |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      HVALS        |    Yes     | HVALS key                                                                                                           |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      HSCAN        |    Yes     | HSCAN key cursor [MATCH pattern] [COUNT count]                                                                      |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
</code></pre>

<h3>Lists</h3>

<pre><code>+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      Command      | Supported? | Format                                                                                                              |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|       BLPOP       |    No      | BLPOP key [key ...] timeout                                                                                         |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|       BRPOP       |    No      | BRPOP key [key ...] timeout                                                                                         |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|     BRPOPLPUSH    |    No      | BRPOPLPUSH source destination timeout                                                                               |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      LINDEX       |    Yes     | LINDEX key index                                                                                                    |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      LINSERT      |    Yes     | LINSERT key BEFORE|AFTER pivot value                                                                                |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      LLEN         |    Yes     | LLEN key                                                                                                            |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      LPOP         |    Yes     | LPOP key                                                                                                            |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      LPUSH        |    Yes     | LPUSH key value [value ...]                                                                                         |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      LPUSHX       |    Yes     | LPUSHX key value                                                                                                    |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      LRANGE       |    Yes     | LRANGE key start stop                                                                                               |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      LREM         |    Yes     | LREM key count value                                                                                                |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      LSET         |    Yes     | LSET key index value                                                                                                |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      LTRIM        |    Yes     | LTRIM key start stop                                                                                                |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      RPOP         |    Yes     | RPOP key                                                                                                            |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|     RPOPLPUSH     |    Yes*    | RPOPLPUSH source destination                                                                                        |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      RPUSH        |    Yes     | RPUSH key value [value ...]                                                                                         |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      RPUSHX       |    Yes     | RPUSHX key value                                                                                                    |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
</code></pre>

<ul>
<li>RPOPLPUSH support requires that source and destination keys hash to the same server. You can ensure this by using the same <a href="recommendation.md#hash-tags">hashtag</a> for source and destination key. Twemproxy does no checking on its end to verify that source and destination key hash to the same server, and the RPOPLPUSH command is forwarded to the server that the source key hashes to</li>
</ul>


<h3>Sets</h3>

<pre><code>+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      Command      | Supported? | Format                                                                                                              |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      SADD         |    Yes     | SADD key member [member ...]                                                                                        |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      SCARD        |    Yes     | SCARD key                                                                                                           |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      SDIFF        |    Yes*    | SDIFF key [key ...]                                                                                                 |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|     SDIFFSTORE    |    Yes*    | SDIFFSTORE destination key [key ...]                                                                                |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      SINTER       |    Yes*    | SINTER key [key ...]                                                                                                |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|    SINTERSTORE    |    Yes*    | SINTERSTORE destination key [key ...]                                                                               |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|     SISMEMBER     |    Yes     | SISMEMBER key member                                                                                                |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|     SMEMBERS      |    Yes     | SMEMBERS key                                                                                                        |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      SMOVE        |    Yes*    | SMOVE source destination member                                                                                     |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      SPOP         |    Yes     | SPOP key                                                                                                            |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|    SRANDMEMBER    |    Yes     | SRANDMEMBER key [count]                                                                                             |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      SREM         |    Yes     | SREM key member [member ...]                                                                                        |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|     SUNION        |    Yes*    | SUNION key [key ...]                                                                                                |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|   SUNIONSTORE     |    Yes*    | SUNIONSTORE destination key [key ...]                                                                               |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      SSCAN        |    Yes     | SSCAN key cursor [MATCH pattern] [COUNT count]                                                                      |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
</code></pre>

<ul>
<li>SIDFF, SDIFFSTORE, SINTER, SINTERSTORE, SMOVE, SUNION and SUNIONSTORE support requires that the supplied keys hash to the same server. You can ensure this by using the same <a href="recommendation.md#hash-tags">hashtag</a> for all keys in the command. Twemproxy does no checking on its end to verify that all the keys hash to the same server, and the given command is forwarded to the server that the first key hashes to.</li>
</ul>


<h3>Sorted Sets</h3>

<pre><code>+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      Command      | Supported? | Format                                                                                                              |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      ZADD         |    Yes     | ZADD key score member [score] [member]                                                                              |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      ZCARD        |    Yes     | ZCARD key                                                                                                           |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      ZCOUNT       |    Yes     | ZCOUNT key min max                                                                                                  |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      ZINCRBY      |    Yes     | ZINCRBY key increment member                                                                                        |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|     ZINTERSTORE   |    Yes*    | ZINTERSTORE destination numkeys key [key ...] [WEIGHTS weight [weight ...]] [AGGREGATE SUM|MIN|MAX]                 |
+------------------------------------------------------------------------------------------------------------------------------------------------------+
|      ZLEXCOUNT    |    Yes     | ZLEXCOUNT key min max                                                                                               |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      ZRANGE       |    Yes     | ZRANGE key start stop [WITHSCORES]                                                                                  |
+------------------------------------------------------------------------------------------------------------------------------------------------------+
|    ZRANGEBYLEX    |    Yes     | ZRANGEBYLEX key min max [LIMIT offset count]                                                                        |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|    ZRANGEBYSCORE  |    Yes     | ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count]                                                         |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      ZRANK        |    Yes     | ZRANK key member                                                                                                    |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|       ZREM        |    Yes     | ZREM key member [member ...]                                                                                        |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|   ZREMRANGEBYLEX  |    Yes     | ZREMRANGEBYLEX key min max                                                                                          |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|   ZREMRANGEBYRANK |    Yes     | ZREMRANGEBYRANK key start stop                                                                                      |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|  ZREMRANGEBYSCORE |    Yes     | ZREMRANGEBYSCORE key min max                                                                                        |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|    ZREVRANGE      |    Yes     | ZREVRANGE key start stop [WITHSCORES]                                                                               |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|  ZREVRANGEBYSCORE |    Yes     | ZREVRANGEBYSCORE key max min [WITHSCORES] [LIMIT offset count]                                                      |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|     ZREVRANK      |    Yes     | ZREVRANK key member                                                                                                 |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|     ZSCORE        |    Yes     | ZSCORE key member                                                                                                   |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|    ZUNIONSTORE    |    Yes*    | ZUNIONSTORE destination numkeys key [key ...] [WEIGHTS weight [weight ...]] [AGGREGATE SUM|MIN|MAX]                 |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      ZSCAN        |    Yes     | ZSCAN key cursor [MATCH pattern] [COUNT count]                                                                      |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
</code></pre>

<ul>
<li>ZINTERSTORE and ZUNIONSTORE support requires that the supplied keys hash to the same server. You can ensure this by using the same <a href="recommendation.md#hash-tags">hashtag</a> for all keys in the command. Twemproxy does no checking on its end to verify that all the keys hash to the same server, and the given command is forwarded to the server that the first key hashes to.</li>
</ul>


<h3>HyperLogLog</h3>

<pre><code>+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      Command      | Supported? | Format                                                                                                              |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|       PFADD       |    Yes     | PFADD key element [element ...]                                                                                     |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      PFCOUNT      |    Yes     | PFCOUNT key [key ...]                                                                                               |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      PFMERGE      |    Yes*    | PFMERGE destkey sourcekey [sourcekey ...]                                                                           |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
</code></pre>

<ul>
<li>PFMERGE support requires that the supplied keys hash to the same server. You can ensure this by using the same <a href="recommendation.md#hash-tags">hashtag</a> for all keys in the command. Twemproxy does no checking on its end to verify that all the keys hash to the same server, and the given command is forwarded to the server that the first key hashes to.</li>
</ul>


<h3>Pub/Sub</h3>

<pre><code>+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      Command      | Supported? | Format                                                                                                              |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|     PSUBSCRIBE    |    No      | PSUBSCRIBE pattern [pattern ...]                                                                                    |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|     PUBLISH       |    No      | PUBLISH channel message                                                                                             |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|    PUNSUBSCRIBE   |    No      | PUNSUBSCRIBE [pattern [pattern ...]]                                                                                |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|     SUBSCRIBE     |    No      | SUBSCRIBE channel [channel ...]                                                                                     |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|     UNSUBSCRIBE   |    No      | UNSUBSCRIBE [channel [channel ...]]                                                                                 |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
</code></pre>

<h3>Transactions</h3>

<pre><code>+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      Command      | Supported? | Format                                                                                                              |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      DISCARD      |    No      | DISCARD                                                                                                             |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|       EXEC        |    No      | EXEC                                                                                                                |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|       MULTI       |    No      | MULTI                                                                                                               |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      UNWATCH      |    No      | UNWATCH                                                                                                             |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|       WATCH       |    No      | WATCH key [key ...]                                                                                                 |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
</code></pre>

<h3>Scripting</h3>

<pre><code>+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      Command      | Supported? | Format                                                                                                              |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|       EVAL        |    Yes*    | EVAL script numkeys key [key ...] arg [arg ...]                                                                     |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|     EVALSHA       |    Yes*    | EVALSHA sha1 numkeys key [key ...] arg [arg ...]                                                                    |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|    SCRIPT EXISTS  |    No      | SCRIPT EXISTS script [script ...]                                                                                   |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|    SCRIPT FLUSH   |    No      | SCRIPT FLUSH                                                                                                        |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|    SCRIPT KILL    |    No      | SCRIPT KILL                                                                                                         |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|    SCRIPT LOAD    |    No      | SCRIPT LOAD script                                                                                                  |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
</code></pre>

<ul>
<li>EVAL and EVALSHA support is limited to scripts that take at least 1 key. If multiple keys are used, all keys must hash to the same server. You can ensure this by using the same <a href="recommendation.md#hash-tags">hashtag</a> for all keys. If you use more than 1 key, the proxy does no checking to verify that all keys hash to the same server, and the entire command is forwarded to the server that the first key hashes to</li>
</ul>


<h3>Connection</h3>

<pre><code>+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      Command      | Supported? | Format                                                                                                              |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|       AUTH        |    No      | AUTH password                                                                                                       |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|       ECHO        |    No      | ECHO message                                                                                                        |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|       PING        |    No      | PING                                                                                                                |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|       QUIT        |    No      | QUIT                                                                                                                |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      SELECT       |    No      | SELECT index                                                                                                        |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
</code></pre>

<h3>Server</h3>

<pre><code>+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      Command      | Supported? | Format                                                                                                              |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|    BGREWRITEAOF   |    No      | BGREWRITEAOF                                                                                                        |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      BGSAVE       |    No      | BGSAVE                                                                                                              |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|    CLIENT KILL    |    No      | CLIENT KILL ip:port                                                                                                 |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|    CLIENT LIST    |    No      | CLIENT LIST                                                                                                         |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|    CONFIG GET     |    No      | CONFIG GET parameter                                                                                                |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|    CONFIG SET     |    No      | CONFIG SET parameter value                                                                                          |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|  CONFIG RESETSTAT |    No      | CONFIG RESETSTAT                                                                                                    |
+-------------------+-------------+--------------------------------------------------------------------------------------------------------------------+
|     DBSIZE        |    No      | DBSIZE                                                                                                              |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|    DEBUG OBJECT   |    No      | DEBUG OBJECT key                                                                                                    |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|    DEBUG SEGFAULT |    No      | DEBUG SEGFAULT                                                                                                      |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|     FLUSHALL      |    No      | FLUSHALL                                                                                                            |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|     FLUSHDB       |    No      | FLUSHDB                                                                                                             |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      INFO         |    No      | INFO                                                                                                                |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|     LASTSAVE      |    No      | LASTSAVE                                                                                                            |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|     MONITOR       |    No      | MONITOR                                                                                                             |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      SAVE         |    No      | SAVE                                                                                                                |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|     SHUTDOWN      |    No      | SHUTDOWN [NOSAVE] [SAVE]                                                                                            |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|     SLAVEOF       |    No      | SLAVEOF host port                                                                                                   |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|     SLOWLOG       |    No      | SLOWLOG subcommand [argument]                                                                                       |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      SYNC         |    No      | SYNC                                                                                                                |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
|      TIME         |    No      | TIME                                                                                                                |
+-------------------+------------+---------------------------------------------------------------------------------------------------------------------+
</code></pre>

<h2>Note</h2>

<ul>
<li>redis commands are not case sensitive</li>
<li>only vectored commands &lsquo;MGET key [key &hellip;]&rsquo;, &lsquo;MSET key value [key value &hellip;]&rsquo;, &lsquo;DEL key [key &hellip;]&rsquo; needs to be fragmented</li>
</ul>


<h2>Performance</h2>

<h3>Setup</h3>

<ul>
<li>redis-server running on machine A.</li>
<li>nutcracker running on machine A as a local proxy to redis-server.</li>
<li>redis-benchmark running on machine B.</li>
<li>machine A != machine B.</li>
<li>nutcracker built with &ndash;enable-debug=no</li>
<li>nutcracker running with mbuf-size of 512 (-m 512)</li>
<li>redis-server built from redis 2.6 branch</li>
</ul>


<h3>redis-benchmark against redis-server</h3>

<pre><code>$ redis-benchmark -h &lt;machine-A&gt; -q -t set,get,incr,lpush,lpop,sadd,spop,lpush,lrange -c 100 -p 6379
SET: 89285.71 requests per second
GET: 92592.59 requests per second
INCR: 89285.71 requests per second
LPUSH: 90090.09 requests per second
LPOP: 90090.09 requests per second
SADD: 90090.09 requests per second
SPOP: 93457.95 requests per second
LPUSH (needed to benchmark LRANGE): 89285.71 requests per second
LRANGE_100 (first 100 elements): 36496.35 requests per second
LRANGE_300 (first 300 elements): 15748.03 requests per second
LRANGE_500 (first 450 elements): 11135.86 requests per second
LRANGE_600 (first 600 elements): 8650.52 requests per second
</code></pre>

<h3>redis-benchmark against nutcracker proxing redis-server</h3>

<pre><code>$ redis-benchmark -h &lt;machine-A&gt; -q -t set,get,incr,lpush,lpop,sadd,spop,lpush,lrange -c 100 -p 22121
SET: 85470.09 requests per second
GET: 86956.52 requests per second
INCR: 85470.09 requests per second
LPUSH: 84745.77 requests per second
LPOP: 86206.90 requests per second
SADD: 84745.77 requests per second
SPOP: 86956.52 requests per second
LPUSH (needed to benchmark LRANGE): 84745.77 requests per second
LRANGE_100 (first 100 elements): 29761.90 requests per second
LRANGE_300 (first 300 elements): 12376.24 requests per second
LRANGE_500 (first 450 elements): 8605.85 requests per second
LRANGE_600 (first 600 elements): 6587.62 requests per second
</code></pre>

<h2>redis-auth feature</h2>

<ul>
<li><p>you can enable redis-auth for a pool with &lsquo;redis_auth&rsquo;:</p>

<pre><code>  alpha:
    listen: 127.0.0.1:22121
    hash: fnv1a_64
    distribution: ketama
    redis: true
    redis_auth: testpass
</code></pre></li>
<li><p>notice:</p>

<ul>
<li><em>MUST</em> set all redis with a same passwd, and all twemproxy with the same passwd</li>
<li>Length of password should less than 256</li>
</ul>
</li>
</ul>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">cooear</span></span>

      




<time class='entry-date' datetime='2016-07-04T16:26:18+08:00'><span class='date'>2016-07-04</span> <span class='time'>4:26 pm</span></time>
      


    </p>
    
      <div class="sharing">
  
  
  
  
     <!-- JiaThis Button BEGIN -->
<div class="jiathis_style_32x32">
	<a class="jiathis_button_qzone"></a>
	<a class="jiathis_button_tsina"></a>
	<a class="jiathis_button_tqq"></a>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_renren"></a>
	<a href="http://www.jiathis.com/share?uid=2017486" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript">
var jiathis_config = {data_track_clickback:'true'};
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1396499123021149" charset="utf-8"></script>
<!-- JiaThis Button END -->

<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="/blog/2016/07/redis-command-support-in-codis" data-title="Redis Command Support In Codis" data-url="http://cooear.com/blog/2016/07/redis-command-support-in-codis/"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"cooear"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	window.setInterval(hideimg, 70); 
	function hideimg() 
	{ 
		if(document.getElementById("ds-wrapper")){
			document.getElementById("ds-wrapper").style.background = "url('')";
		}
	} 
	</script>
<!-- 多说公共JS代码 end -->
 
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2016/05/create-amazon-web-services/" title="Previous Post: Amazon EC2免费虚拟主机搭建">&laquo; Amazon EC2免费虚拟主机搭建</a>
      
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/07/redis-command-support-in-codis/">Redis Command Support in Codis</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/05/create-amazon-web-services/">Amazon EC2免费虚拟主机搭建</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/05/new-gae-create/">最新Google GAE账号注册</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/05/git-toturial/">Git命令大全</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/05/xx-net-jie-li-goagent/">XX-Net接力GoAgent的工具</a>
      </li>
    
  </ul>
</section>




<section>
  <h1>Tags</h1>
  <ul class="tag-cloud">
<a style="font-size: 90%" href="/tags/rsync/">rsync</a>
<a style="font-size: 141%" href="/tags/switchyomega/">SwitchyOmega</a>
<a style="font-size: 154%" href="/tags/ming-ling/">命令</a>
<a style="font-size: 90%" href="/tags/fen-xi/">分析</a>
<a style="font-size: 90%" href="/tags/proxy-switchyomega/">Proxy SwitchyOmega</a>
<a style="font-size: 164%" href="/tags/lantern/">Lantern</a>
<a style="font-size: 180%" href="/tags/linux/">Linux</a>
<a style="font-size: 90%" href="/tags/redis/">Redis</a>
<a style="font-size: 90%" href="/tags/scp/">scp</a>
<a style="font-size: 90%" href="/tags/openwrt/">Openwrt</a>
<a style="font-size: 173%" href="/tags/vpn/">VPN</a>
<a style="font-size: 122%" href="/tags/gae/">GAE</a>
<a style="font-size: 173%" href="/tags/gfw/">GFW</a>
<a style="font-size: 141%" href="/tags/fan-qiang/">翻墙</a>
<a style="font-size: 164%" href="/tags/goagent/">GoAgent</a>
<a style="font-size: 154%" href="/tags/gmail/">Gmail</a>
<a style="font-size: 90%" href="/tags/cha-kan-yong-hu/">查看用户</a>
<a style="font-size: 90%" href="/tags/huan-dian-chi/">换电池</a>
<a style="font-size: 90%" href="/tags/github/">GitHub</a>
<a style="font-size: 90%" href="/tags/ji-huo/">激活</a>
<a style="font-size: 90%" href="/tags/an-quan/">安全</a>
<a style="font-size: 90%" href="/tags/pkill/">pkill</a>
<a style="font-size: 90%" href="/tags/command/">command</a>
<a style="font-size: 90%" href="/tags/amazon/">Amazon</a>
<a style="font-size: 90%" href="/tags/ec2/">EC2</a>
<a style="font-size: 90%" href="/tags/ri-zhi/">日志</a>
<a style="font-size: 141%" href="/tags/google/">Google</a>
<a style="font-size: 90%" href="/tags/iphone/">Iphone</a>
<a style="font-size: 90%" href="/tags/codis/">codis</a>
<a style="font-size: 90%" href="/tags/git/">git</a>
<a style="font-size: 122%" href="/tags/chrome/">Chrome</a>
<a style="font-size: 122%" href="/tags/xx-net/">XX-Net</a>
<a style="font-size: 122%" href="/tags/shadowsocks/">ShadowSocks</a>
<a style="font-size: 90%" href="/tags/jiao-cheng/">教程</a>
<a style="font-size: 90%" href="/tags/switchysharp/">switchysharp</a>
<a style="font-size: 154%" href="/tags/yu-fa/">语法</a>
<a style="font-size: 90%" href="/tags/win8/">win8</a>
<a style="font-size: 90%" href="/tags/yii/">Yii</a>

  </ul>
</section>
<section style="margin-left: -18px;">
  <h1></h1>
<script type="text/javascript">
    /*300*250 创建于 2016-05-11*/
    var cpro_id = "u2636048";
</script>
<script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>
</section>
<section style="margin-left: -18px;">
  <h1></h1>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Google ad1 -->
<ins class="adsbygoogle"
     style="display:inline-block;width:300px;height:250px"
     data-ad-client="ca-pub-6936921240898056"
     data-ad-slot="7715814525"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</section><!--返回顶部开始-->
<div id="full" style="height:0px; position:fixed; right:5%; bottom:12%; z-index:100; text-align:center; background-color:transparent; cursor:pointer;">
	<a href="#" onclick="goTop();return false;"><img src="/images/top.png" style="border:0" border=0 alt="返回顶部" /></a>
</div>
<script src="/javascripts/top.js" type="text/javascript"></script>
<!--返回顶部结束-->
  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - cooear -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> & <a href="http://cooear.com">酷耳</a>.</span>
</p>
<script>
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "//hm.baidu.com/hm.js?a8e2bd164d0f4e6ce26d50a36471c121";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
</script>
</footer>
  











</body>
</html>
